# ~~ Generated by projen. To modify, edit .projenrc.js and run "npx projen".

build:
  image:
    name: alpine
  needs: []
  variables:
    ci: "true"
  artifacts:
    paths:
      - .repo.patch
      - dist
    reports:
      dotenv:
        - .exports.env
  script:
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - yarn install --check-files
    - /bin/bash ./projen.bash build
    - git add .
    - >-
      if git diff --staged --patch --exit-code > .repo.patch; then
        self_mutation_happened=1
      else
        echo "Files were changed during build (see build log). If this was triggered from a fork, you will need to update your branch."
        cat .repo.patch
        exit 1
      fi
    - echo "self_mutation_happened="$self_mutation_happened"" >> .exports.env
self_mutation:
  image:
    name: alpine
  needs:
    - build
  artifacts: {}
  script:
    - apk add --update git bash rsync
    - '[ -s ./.repo.patch ] && git apply ./.repo.patch || echo "Empty patch.
      Skipping."'
    - rm -f ./.repo.patch
    - git config user.name "github-actions"
    - git config user.email "github-actions@github.com"
    - git add .
    - 'git commit -m -s "chore: self mutation"'
    - git push origin HEAD:${{ github.event.pull_request.head.ref }}
package_js:
  image:
    name: alpine
  needs:
    - build
  artifacts: {}
  script:
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - mv dist .repo
    - cd .repo && yarn install --check-files --frozen-lockfile
    - cd .repo && npx projen package:js
    - mv .repo/dist dist
package_java:
  image:
    name: alpine
  needs:
    - build
  artifacts: {}
  script:
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - apk add --update openjdk11-jre
    - mv dist .repo
    - cd .repo && yarn install --check-files --frozen-lockfile
    - cd .repo && npx projen package:java
    - mv .repo/dist dist
package_python:
  image:
    name: alpine
  needs:
    - build
  artifacts: {}
  script:
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - apk add --update python3
    - mv dist .repo
    - cd .repo && yarn install --check-files --frozen-lockfile
    - cd .repo && npx projen package:python
    - mv .repo/dist dist
package_go:
  image:
    name: alpine
  needs:
    - build
  artifacts: {}
  script:
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - apk add --update go
    - mv dist .repo
    - cd .repo && yarn install --check-files --frozen-lockfile
    - cd .repo && npx projen package:go
    - mv .repo/dist dist
post_build_integ:
  image:
    name: alpine
  needs:
    - build
  artifacts: {}
  script:
    - apk add --update git bash rsync
    - apk add --update python3
    - apk add --update go
    - yarn install --check-files --frozen-lockfile
    - /bin/bash ./projen.bash integ
