# ~~ Generated by projen. To modify, edit .projenrc.js and run "npx projen".

build:
  image:
    name: alpine
  needs: []
  variables:
    CI: "true"
  artifacts:
    paths:
      - dist
    when: always
  script:
    - "echo -e \"e[0Ksection_start:$(date +%s):section_2\re[0KSetup tools\""
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - "echo -e \"e[0Ksection_end:$(date +%s):section_2\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KInstall
      dependencies\""
    - yarn install --check-files
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KBuild\""
    - /bin/bash ./projen.bash build
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KCheck for
      self-mutation\""
    - >-
      git add .

      mkdir -p dist

      if ! git diff --staged --patch --exit-code > dist/patch.diff; then
        echo "Files were changed during build (see build log). If this was triggered from a fork, you will need to update your branch."
        cat dist/patch.diff
        exit 1
      fi
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
  after_script: []
self-mutation:
  image:
    name: alpine
  needs:
    - build
  rules:
    - when: always
  variables:
    PROJEN_TOKEN: $PROJEN_TOKEN
  artifacts: {}
  script:
    - |-
      if true && ! false; then
        __cond__=true
      else
        echo "Job skipped"
        __cond__=false
      fi
    - "${__cond__} && echo -e \"e[0Ksection_start:$(date
      +%s):section_2\re[0KSetup tools\""
    - ${__cond__} && apk add --update git bash rsync
    - ${__cond__} && apk add --update nodejs npm yarn
    - "${__cond__} && echo -e \"e[0Ksection_end:$(date +%s):section_2\re[0K\""
    - "${__cond__} && echo -e \"e[0Ksection_start:$(date
      +%s):section_1\re[0KSkip if there was no self-mutation\""
    - ${__cond__} && [ -s ./dist/patch.diff ] || exit 0
    - "${__cond__} && echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "${__cond__} && echo -e \"e[0Ksection_start:$(date
      +%s):section_1\re[0KApply self-mutation\""
    - |-
      ${__cond__} && git apply ./dist/patch.diff
      rm -rf ./dist
    - "${__cond__} && echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "${__cond__} && echo -e \"e[0Ksection_start:$(date
      +%s):section_1\re[0KPush changes\""
    - |-
      ${__cond__} && git config user.name "github-actions"
      git config user.email "github-actions@github.com"
      git add .
      git commit -s -m "chore: self mutation"
    - "${__cond__} && echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - apk add --update openssh
    - git remote set-url --push origin
      https://${GITLAB_USER_LOGIN}:${PROJEN_TOKEN}@${CI_SERVER_HOST}/${CI_PROJECT_NAMESPACE}/${CI_PROJECT_NAME}.git
    - git push origin HEAD:${CI_COMMIT_REF_NAME}
  after_script: []
package-js:
  image:
    name: alpine
  needs:
    - build
  variables: {}
  artifacts: {}
  script:
    - "echo -e \"e[0Ksection_start:$(date +%s):section_2\re[0KSetup tools\""
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - "echo -e \"e[0Ksection_end:$(date +%s):section_2\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KSkip if
      self-mutation happened\""
    - "[ -s ./dist/patch.diff ] && exit 0"
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KPrepare
      repository\""
    - mv dist .repo
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KInstall
      dependencies\""
    - (cd .repo && yarn install --check-files --frozen-lockfile)
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KPackage for js\""
    - (cd .repo && npx projen package:js)
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KExtract build
      artifacts\""
    - mv .repo/dist dist
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
  after_script: []
package-java:
  image:
    name: alpine
  needs:
    - build
  variables: {}
  artifacts: {}
  script:
    - "echo -e \"e[0Ksection_start:$(date +%s):section_3\re[0KSetup tools\""
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - apk add --update openjdk11-jre
    - "echo -e \"e[0Ksection_end:$(date +%s):section_3\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KSkip if
      self-mutation happened\""
    - "[ -s ./dist/patch.diff ] && exit 0"
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KPrepare
      repository\""
    - mv dist .repo
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KInstall
      dependencies\""
    - (cd .repo && yarn install --check-files --frozen-lockfile)
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KPackage for java\""
    - (cd .repo && npx projen package:java)
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KExtract build
      artifacts\""
    - mv .repo/dist dist
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
  after_script: []
package-python:
  image:
    name: alpine
  needs:
    - build
  variables: {}
  artifacts: {}
  script:
    - "echo -e \"e[0Ksection_start:$(date +%s):section_3\re[0KSetup tools\""
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - apk add --update python3
    - "echo -e \"e[0Ksection_end:$(date +%s):section_3\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KSkip if
      self-mutation happened\""
    - "[ -s ./dist/patch.diff ] && exit 0"
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KPrepare
      repository\""
    - mv dist .repo
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KInstall
      dependencies\""
    - (cd .repo && yarn install --check-files --frozen-lockfile)
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KPackage for
      python\""
    - (cd .repo && npx projen package:python)
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KExtract build
      artifacts\""
    - mv .repo/dist dist
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
  after_script: []
package-go:
  image:
    name: alpine
  needs:
    - build
  variables: {}
  artifacts: {}
  script:
    - "echo -e \"e[0Ksection_start:$(date +%s):section_3\re[0KSetup tools\""
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - apk add --update go
    - "echo -e \"e[0Ksection_end:$(date +%s):section_3\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KSkip if
      self-mutation happened\""
    - "[ -s ./dist/patch.diff ] && exit 0"
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KPrepare
      repository\""
    - mv dist .repo
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KInstall
      dependencies\""
    - (cd .repo && yarn install --check-files --frozen-lockfile)
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KPackage for go\""
    - (cd .repo && npx projen package:go)
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KExtract build
      artifacts\""
    - mv .repo/dist dist
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
  after_script: []
post-build-integ:
  image:
    name: alpine
  needs:
    - build
  variables: {}
  artifacts: {}
  script:
    - "echo -e \"e[0Ksection_start:$(date +%s):section_4\re[0KSetup tools\""
    - apk add --update git bash rsync
    - apk add --update nodejs npm yarn
    - apk add --update python3
    - apk add --update go
    - "echo -e \"e[0Ksection_end:$(date +%s):section_4\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KSkip if
      self-mutation happened\""
    - "[ -s ./dist/patch.diff ] && exit 0"
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0KInstall
      dependencies\""
    - yarn install --check-files --frozen-lockfile
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
    - "echo -e \"e[0Ksection_start:$(date +%s):section_1\re[0Kpost-build-integ\""
    - /bin/bash ./projen.bash integ
    - "echo -e \"e[0Ksection_end:$(date +%s):section_1\re[0K\""
  after_script: []
